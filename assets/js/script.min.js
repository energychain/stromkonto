$(document).ready(function(){$(".iot").iot()});let t=null,e=null;function a(t){return"0x445c1e284c15a50a69fe7d6dcd9fba3b938b52bb"==(t=(""+t).toLowerCase())?" Eigenerzeugung aus Corrently Anlagen":"0xdcbab2b1c28b6f57c367f4eff0f5c7893400cc4d"==t?"Grünstrombonus":"0x961aa3954c3af05c975433f095e9567780a4d6d2"==t?"Epiktet Beteiligung - Solar Rhein-Neckar":"0x41b7931ea8f072dcc77f1f682cd5a1273ff7dbe6"==t?"Epiktet Beteiligung - Solar Saarland":"0xabbd396e4e96517a63a834a3177f8b2809e1bd6682547f1d07bc5bf8073a99d3"==t?"Epiktet Beteiligung - Solar Rhein-Neckar":"0xc24f09705a3c5aec517bfad76761e05f6701cf75b5b7652da13b6e5279e47617"==t?"Epiktet Beteiligung - Solar Saarland":t}function n(t){if(null==window.localStorage.getItem("webview"))return;let e={},a=Object.keys(localStorage);for(var n=0;n<a.length;n++)e[a[n]]=window.localStorage.getItem(a[n]);null!=e&&$.post("https://api.corrently.io/core/webuser",e,function(e){"function"==typeof t&&t()})}function o(){null!=typeof window.localStorage.getItem("webview")&&n(),window.localStorage.clear();let e=new CorrentlyWallet.default.Wallet(CorrentlyWallet.default.utils.id($("#web_name").val()+"@"+$("#web_password").val()),new CorrentlyWallet.default.providers.JsonRpcProvider("https://node.corrently.io/"));window.localStorage.setItem("webview",e.address),t=e,$.getJSON("https://api.corrently.io/core/webuser?webview="+e.address,function(t){if(void 0===t.webview)$("#btn_webview").hide(),$("#valigroup").show(),$("#btn_vali").click(function(){if($("#web_password").val()==$("#pwd2").val()){$("#valigroup").hide();let t={};t.webview=e.address,$.post("https://api.corrently.io/core/webuser",t,function(t){$(".corrently-panels").hide(),$(".appcontent").show()})}else alert("Passwörter stimmen nicht überein")});else{let e=Object.keys(t);for(var a=0;a<e.length;a++)window.localStorage.setItem(e[a],t[e[a]]);$(".corrently-panels").hide(),$(".appcontent").show()}})}$.qparam=function(t){var e=new RegExp("[?&]"+t+"=([^&#]*)").exec(window.location.search);return null!==e&&(e[1]||0)};let c={txpage:0},l=[];l.last_balance_eur=0;let r={};function i(){$(".corrently-panels").hide();new Vue({el:"#app",data:c});$("#app").attr("initialized","true"),$(".appcontent").show()}function s(){r.blocktime="",r.blocknumber="";new Vue({el:"#bcstatus",data:r});$("#bcstatus").attr("initialized","true"),setInterval(u,6e4),u()}function u(){new CorrentlyWallet.default.Wallet(CorrentlyWallet.default.Wallet.createRandom().privateKey,new CorrentlyWallet.default.providers.JsonRpcProvider("https://node.corrently.io/rpc",{chainId:42})).provider.getBlockNumber().then(function(t){r.blocknumber=t})}function d(){var t="";if(void 0===c.account.gsi)return void $.getJSON("https://api.corrently.io/core/gsi?plz=69256",function(t){c.account.gsi=t,c.account.gsi.bonus=.05,$("#info_gsi_ort").html("<strong>DEMO:</strong> Grünstrom Bonus von Mauer (bei Heidelberg)"),d()});console.log("Account gsi();"),c.green_power=(c.account.gsi.points/(c.account.gsi.points+c.account.gsi.residual)*100).toFixed(1).replace(".",","),$("#gsi_bonus").html((100*c.account.gsi.bonus).toFixed(2).replace(".",",")),t+="<table class='table table-sm table-responsive' style='margin:0px;'>";let e="<td class='bg-secondary text-light'>Uhrzeit</td>",a="<td class='bg-secondary text-light'>&nbsp;</td>",n="<td>Cent/kWh</td>",o="";for(var l=0;l<c.account.gsi.forecast.length;l++){let t=c.account.gsi.forecast[l],d=1e3*t.epochtime;var r=new Date(d),i=r.getDate(),s=r.getMonth()+1,u=(r.getFullYear(),i+"."+s);d>(new Date).getTime()&&(t.eevalue<30?n+="<td class='bg-danger gsi'  style='text-align:center' title='"+t.eevalue+"%'>":t.eevalue>70?n+="<td class='bg-success gsi' style='text-align:center' title='"+t.eevalue+"%'>":n+="<td class='bg-warning gsi' style='text-align:center' title='"+t.eevalue+"%'>",n+=(c.account.gsi.bonus*t.eevalue).toFixed(2).replace(".",","),n+="</td>",e+="<td class='bg-secondary text-light gsi' style='min-widht:70px;text-align:center' title='"+new Date(d).toLocaleString()+"'>",e+=new Date(d).getHours()+":00",e+="</td>",u!=o?(o=u,a+="<td class='bg-secondary text-light' style='min-widht:70px;text-align:center;border-left:1px solid #c6c6c6' title='"+new Date(d).toLocaleString()+"'>",a+="<strong>"+u+"</strong>"):(a+="<td class='bg-secondary text-light' style='min-widht:70px;text-align:center;' title='"+new Date(d).toLocaleString()+"'>",a+="&nbsp;"),a+="</td>")}t+="<tr>"+a+"</tr>",t+="<tr>"+e+"</tr>",t+="<tr style='height:45px;'>"+n+"</tr>",t+="</table>",$("#gsi").html(t),$("#gsi").show(),$("#gsi_card").show()}function g(t){let e=window.localStorage.getItem("ts_"+t);if(null==e){return new CorrentlyWallet.default.providers.JsonRpcProvider("https://node.corrently.io/rpc",{chainId:42}).getBlock(t).then(function(a){e=a.timestamp,window.localStorage.setItem("ts_"+t,e);for(var n=0;n<c.txs.length;n++)c.txs[n].blockNumber==t&&(c.txs[n].timeStamp=new Date(1e3*e).toLocaleString())}),"#"+t}return new Date(1e3*e).toLocaleString()}function p(){if(42==$("#account").val().length){$("#account").val();let t={stromkonto:$("#account").val()};t["gsi_"+$("#account").val()]="Y","localhost"!=location.hostname&&"127.0.0.1"!=location.hostname&&OneSignal.sendTags(t).then(function(t){}),$.getJSON("https://api.corrently.io/notification/stromkonto_notify?account="+$("#account").val(),function(t){})}}function h(){$(".corrently-panels").hide(),$(".appcontent").show(),window.localStorage.removeItem("alias_dress"),null!=window.localStorage.getItem("webview")&&$("#webuser").html(" | "+window.localStorage.getItem("webview")),$("#account_nr").html($("#account").val()),($("#account_alias").val()+"").length>0&&"dress"!=$("#account_alias").val()&&(null==window.localStorage.getItem("alias_"+$("#account_alias").val())&&(window.localStorage.setItem("alias_"+$("#account_alias").val(),$("#account").val()),n()),$("#frm_panel").hide(),$(".appcontent").show()),42!=($("#account").val()+"").length&&"dress"!=$("#account_alias").val()&&$("#account").val(window.localStorage.getItem("alias_"+$("#account").val()));let t=Object.keys(localStorage);for(var e=0;e<t.length;e++)window.localStorage.getItem(t[e])==$("#account").val()&&"dress"!=t[e].substr(6)&&($("#account_alias").val(t[e].substr(6)),$("#account_nr").html(t[e].substr(6)));$("#account_nr").attr("title",$("#account").val()),window.localStorage.setItem("lastAddress",$("#account").val()),CorrentlyWallet.default.Stromkonto($("#account").val()).then(function(t){CorrentlyWallet.default.CorrentlyAccount($("#account").val()).then(function(e){c=t.result,w(),void 0===e.ap&&$("#tarifalert").removeClass("d-none"),c.green_power="-",c.account=e,void 0!==c.account.generation?(c.account.preGain=c.account.generation,0!=c.haben&&void 0!==c.account.ap&&(c.account.clearedGeneration+=c.haben/c.account.ap/1e5),void 0===c.account.clearedGeneration&&(c.account.clearedGeneration=0),c.account.gain=c.account.clearedGeneration-c.account.preGain,c.generation_3f=c.account.clearedGeneration.toFixed(3).replace(".",",")):c.generation_3f=0,void 0!==c.account.nominalCori?c.kwha=c.account.nominalCori+" kWh/Jahr":c.kwha="0 kWh/Jahr",void 0===c.account.txs&&(c.account.txs=[]);var n=(new Date).getTime();c.account.txs=c.account.txs.reverse();let o=0;for(var r={},s=0;s<c.account.txs.length;s++)c.account.txs[s].cori=1*c.account.txs[s].cori,c.account.txs[s].generation=Math.abs(c.account.txs[s].cori*((c.account.txs[s].timeStamp-n)/31536e6)),void 0!==c.account.txs[s].contract?c.account.txs[s].peer=a(c.account.txs[s].contract):c.account.txs[s].peer=a(c.account.txs[s].asset),c.account.txs[s].timeStamp=new Date(c.account.txs[s].timeStamp).toLocaleString(),o+=c.account.txs[s].generation,void 0===r[c.account.txs[s].peer]&&(r[c.account.txs[s].peer]={generation:0,cori:0}),r[c.account.txs[s].peer].peer=c.account.txs[s].peer,r[c.account.txs[s].peer].generation+=c.account.txs[s].generation,r[c.account.txs[s].peer].cori+=c.account.txs[s].cori,c.account.txs[s].generation=c.account.txs[s].generation.toFixed(5).replace(".",",");c.account.txs_aggregated=r,void 0===c.account.things?c.account.things={}:$("#things-card-collapsed").remove();for(s=0;s<c.account.things.length;s++)void 0===c.account.things[s].title&&(c.account.things[s].title=c.account.things[s].account),void 0===c.account.things[s].base_add&&(c.account.things[s].base_add=0),void 0===c.account.things[s].ap&&void 0!==c.account.ap&&(c.account.things[s].ap=c.account.ap),c.account.things[s].timeStamp="-",$.getJSON("https://api.corrently.io/core/iot?account="+c.account.things[s].account,function(t){for(var e=0;e<c.account.things.length;e++)c.account.things[e].account==t.result.account&&(t.result.value+=c.account.things[e].base_add,c.account.things[e].timeStamp=new Date(t.result.timeStamp).toLocaleString(),c.account.things[e].base=(t.result.value/1e3).toFixed(3).replace(".",","),c.account.things[e].eur=t.result.value/1e3*c.account.things[e].ap,c.account.things[e].eur>1?c.account.things[e].eur=c.account.things[e].eur.toFixed(2).replace(".",","):c.account.things[e].eur=c.account.things[e].eur.toFixed(5).replace(".",","))});c.generation_3f=o.toFixed(3).replace(".",","),c.account.txs.length>11&&(c.account.txs=c.account.txs.slice(0,12),$("#max_asset_rows").show()),void 0===c.account.sev?($("#fc_tarif").hide(),c.account.sev={},c.account.sev.t_instalment=0,c.account.sev.m_instalment=0,c.account.sev.c_instalment=0,c.account.sev.ja="-"):$("#fc_tarif").show(),c.txs=l,"true"!=$("#app").attr("initialized")&&i(),"function"==typeof t.transactions&&t.transactions().then(function(t){let e=c.balance;t=t.slice(0,12);for(var n=0;n<t.length;n++)t[n].peer_account=t[n].peer,t[n].peer=a(t[n].peer),"0xdcbab2b1c28b6f57c367f4eff0f5c7893400cc4d"==t[n].from&&(t[n].peer+=" (für "+t[n].base_abs+" kWh)"),t[n].timeStamp=g(t[n].blockNumber),e-=1e5*t[n].value;l=t,c.txs=t,$("#start_saldo").html((e/1e5).toFixed(5).replace(".",","))}),c.balance<1?($("#buy_btn").attr("disabled","disabled"),$("#wire_btn").attr("disabled","disabled")):($("#buy_btn").removeAttr("disabled"),$("#wire_btn").attr("disabled","disabled")),$("#app").show(),d(),setTimeout(h,12e4),$("#buy_btn").click(function(){$(".corrently-panels").hide(),$("#market_panel").show()}),$("#btn_tx").attr("onclick","javascript:toggle('tx-card','toggle_tx');"),$("#btn_asset").attr("onclick","javascript:toggle('asset-card','toggle_asset');"),$("#btn_things").attr("onclick","javascript:toggle('things-card','toggle_things');"),$("#btn_tarif").attr("onclick","javascript:toggle('tarif-card','toggle_tarif');"),f("tx-card","toggle_tx",!0),f("asset-card","toggle_asset",!0),f("things-card","toggle_things",!0),f("tarif-card","toggle_tarif",!0)})})}function w(){null==e&&void 0!==c.balance_eur&&setTimeout(function(){CorrentlyWallet.default.Market().then(function(t){e=t;let a="";for(var n=0;n<t.length;n++){a+="<tr>",a+="<td title='"+t[n].asset+"'>"+t[n].title+"</td>",a+="<td title='"+t[n].contract+"'>"+t[n].emitent+"</td>",a+="<td>"+t[n].decom+"</td>";let e=Math.floor(100*c.balance_eur/t[n].cori);a+="<td><button class='btn btn-warning btn-sm buytx' enabled='enabled' data='"+t[n].asset+"' data-asset='"+t[n].contract+"' data-kap='"+e+"' data-cori='"+t[n].cori+"' data-funding='"+Math.round(100*c.balance_eur)+"' data-title='"+t[n].title+"'>"+e+" kWh/Jahr</button></td>",a+="</tr>"}$("#market_table").html(a),$("#btn_close_market").click(function(){location.reload(!1)}),$("#markettx").hide(),$(".buytx").click(function(t){$("#markettx").show(),$("#market_sel_kap").val($(t.currentTarget).attr("data-kap")),$("#market_sel_cori").val($(t.currentTarget).attr("data-cori")),$("#market_sel_contract").val($(t.currentTarget).attr("data")),$("#market_sel_asset").val($(t.currentTarget).attr("data-asset")),$("#market_sel_title").val($(t.currentTarget).attr("data-title")),$("#market_sel_sko").val(c.account.account),$("#btn_markettx").click(function(){let t=new CorrentlyWallet.default.Wallet(CorrentlyWallet.default.utils.id($("#market_name").val()+"@"+$("#market_password").val()),new CorrentlyWallet.default.providers.JsonRpcProvider("https://node.corrently.io/"));$(".corrently-panels").hide(),t.buyCapacity($("#market_sel_contract").val(),$("#market_sel_kap").val(),c.account.account).then(function(t){setTimeout(h,8e3)})})})});var t=!1;if(void 0!==c.account.aliases)for(var a=0;a<c.account.aliases.length;a++)c.account.aliases[a]==window.localStorage.getItem("webview")&&(t=!0);t?$("#keyAlert").hide():$("#keyAlert").show()},1e3)}function b(){$(".corrently-panels").hide(),$("#web_panel").show()}function f(t,e,a){var n=window.localStorage.getItem("view_"+t);void 0===a&&(a=!1),n=!a&&(null==n||0==n||"false"==n),window.localStorage.setItem("view_"+t,n),n||"true"==n?($("#"+t).show(),$("#"+t+"-collapsed").hide(),$("#"+e).removeClass("fa-chevron-circle-down"),$("#"+e).addClass("fa-chevron-circle-up")):($("#"+t).hide(),$("#"+t+"-collapsed").show(),$("#"+e).removeClass("fa-chevron-circle-up"),$("#"+e).addClass("fa-chevron-circle-down"))}$(document).ready(function(){if($(".corrently-panels").hide(),$("#app").hide(),$("#gsi").hide(),$("#valigroup").hide(),$("#account_alias").val(""),$("#btn_switch_ledger").click(b),$("#reload_link").click(function(){location.reload(!1)}),$("#btn_remove").click(function(){window.localStorage.removeItem("alias_"+$("#account_alias").val()),n()}),s(),$.qparam("a"))$("#account").val($.qparam("a"));else if(window.localStorage.getItem("privateKey")){let t=new CorrentlyWallet.default.Wallet(window.localStorage.getItem("privateKey"));console.log("Key from localStorage"),$("#account").val(t.address)}else if(window.localStorage.getItem("lastAddress")&&42==window.localStorage.getItem("lastAddress").length)console.log("Account from History"),$("#account").val(window.localStorage.getItem("lastAddress"));else{console.log("Key/Account from New");let t=CorrentlyWallet.default.Wallet.createRandom();$("#account").val(t.address)}$("#btn_open").click(h),$("#btn_webview").click(o),$("#mform").submit(function(){return!1}),h(),p(),$("#btn_change").click(function(){$(".corrently-panels").hide(),$("#frm_panel").show();let t="",e=Object.keys(localStorage);for(var a=0;a<e.length;a++)"alias_"==e[a].substr(0,6)&&(t+='<a class="dropdown-item" role="presentation" href="/?a='+window.localStorage.getItem(e[a])+'" >'+e[a].substr(6)+"</a>");$("#history").html(t)}),"webuser"==$.qparam("goto")&&setTimeout(b,2e3),"true"==$.qparam("setalias")&&setTimeout(function(){$(".corrently-panels").hide(),$("#frm_panel").show();let t="",e=Object.keys(localStorage);for(var a=0;a<e.length;a++)"alias_"==e[a].substr(0,6)&&(t+='<a class="dropdown-item" role="presentation" href="/?a='+window.localStorage.getItem(e[a])+'" >'+e[a].substr(6)+"</a>");$("#history").html(t)},2e3)}),$(".prod_btn").click(function(t){$("#prodauswahl").val(t.currentTarget.id),location.href="#stammdaten"}),$("document").ready(function(){"function"==typeof boot&&boot()});