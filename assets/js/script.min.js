$(document).ready(function() {
    $('.iot').iot();
});
$.qparam = function (name) {
    var results = new RegExp('[\?&]' + name + '=([^&#]*)')
                      .exec(window.location.search);

    return (results !== null) ? results[1] || 0 : false;
}

let stromkonto_data= {};

function initVue()  {
  let view = new Vue({
        el: '#app',
        data: stromkonto_data});
  $('#app').attr("initialized","true");
                
}
function openAccount() {    
    
    CorrentlyWallet.default.Stromkonto($('#account').val()).then(function(l) { 
        stromkonto_data = l.result;
        if( $('#app').attr("initialized")!="true") initVue();
        $('#app').show();    
        setTimeout(openAccount,31000);
    });        
    
}

$(document).ready(function() {
    $('#app').hide();
    if($.qparam("a")) {
        $('#account').val($.qparam("a"));
    } else {
        if(window.localStorage.getItem("privateKey")) {
           let lwallet = new CorrentlyWallet.default.Wallet(window.localStorage.getItem("privateKey"));
            $('#account').val(lwallet.address);
        } else {
            let lwallet = CorrentlyWallet.default.Wallet.createRandom();
            $('#account').val(lwallet.address);
        }
    }
    $('#btn_open').click(openAccount);
    openAccount();    
});
